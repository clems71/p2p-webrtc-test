(this["webpackJsonppeer-test"]=this["webpackJsonppeer-test"]||[]).push([[0],{19:function(e,n,t){},22:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=22},24:function(e,n,t){"use strict";t.r(n);var o=t(1),c=t.n(o),r=t(8),a=t.n(r),i=(t(19),t(3)),s=t(7),u=t(9),l=t(10),d=t(14),p=t(13),h=t(2),b=t.n(h),j=t(11),f=t.n(j),v=t(12),g=t.n(v),O=t(0),y=function(){var e=Math.random().toString(36).substring(7),n=Math.random().toString(36).substring(7);return"".concat(e,"-").concat(n)},m=function(e){Object(d.a)(t,e);var n=Object(p.a)(t);function t(e){var o;return Object(u.a)(this,t),(o=n.call(this)).username=e,o.peerId=void 0,o.peer=void 0,o.connections=new Map,o.conversation=[],o.isLoading=!0,o.lastError=null,o.peerId=e?"".concat(t.PeerIDSeed,"-").concat(b.a.kebabCase(e)):t.PeerIDSeed,o.peer=new f.a(o.peerId),o.peer.on("error",(function(e){console.error(e),o.isLoading=!1,"peer-unavailable"===e.type?o.lastError="peer is unreachable":"unavailable-id"===e.type?o.lastError="".concat(o.peerId," is already taken"):o.lastError=e,o.emit("update")})),o.peer.on("connection",(function(e){console.debug("[".concat(o.peerId,"] peer ").concat(e.peer," reached us")),o.handleNewConnection(e)})),o.peer.on("open",(function(){o.isLoading=!1,o.lastError=null,console.debug("[".concat(o.peerId,"] connected")),o.emit("update"),o.connectToPeer(t.PeerIDSeed)})),o}return Object(l.a)(t,[{key:"connectToPeer",value:function(e){if(!this.connections.has(e)&&e!==this.peerId){console.debug("[".concat(this.peerId,"] connecting to ").concat(e));var n={metadata:{peerIds:Array.from(this.connections.keys())},serialization:"json"},t=this.peer.connect(e,n);this.handleNewConnection(t)}}},{key:"handleNewConnection",value:function(e){var n,t=this;this.connections.has(e.peer)||((null!==(n=e.metadata.peerIds)&&void 0!==n?n:[]).forEach((function(e){return t.connectToPeer(e)})),e.on("data",(function(n){console.debug("[".concat(t.peerId,"] peer ").concat(e.peer," sent a message type=").concat(n.type)),"seeds"===n.type?b.a.each(n.peerIds,(function(e){return t.connectToPeer(e)})):"chat"===n.type&&(t.conversation=[].concat(Object(s.a)(t.conversation),Object(s.a)(n.lines)),t.conversation=b.a.uniqBy(t.conversation,(function(e){return e.id}))),t.emit("update")})),e.on("close",(function(){return t.connections.delete(e.peer)})),e.on("error",(function(){return t.connections.delete(e.peer)})),e.on("open",(function(){t.connections.set(e.peer,e);var n={type:"seeds",peerIds:Array.from(t.connections.keys())};t.send(n);var o={type:"chat",lines:t.conversation};t.send(o),console.debug("[".concat(t.peerId,"] peer ").concat(e.peer," connected"))})))}},{key:"send",value:function(e){this.connections.forEach((function(n){n.send(e)}))}},{key:"error",get:function(){return this.lastError}},{key:"loading",get:function(){return this.isLoading}},{key:"chat",get:function(){return this.conversation}},{key:"sendMessage",value:function(e){var n;if(this.loading)throw new Error("not ready yet");var t={id:y(),content:e,sender:null!==(n=this.username)&&void 0!==n?n:"seed"};this.conversation.push(t);var o={type:"chat",lines:[t]};this.send(o)}}]),t}(g.a);m.PeerIDSeed="407d10227d90";new m;var x=function(e){var n=Object(o.useState)(""),t=Object(i.a)(n,2),c=t[0],r=t[1],a=b.a.kebabCase(c);return Object(O.jsx)("div",{children:Object(O.jsx)("form",{children:Object(O.jsxs)("fieldset",{children:[Object(O.jsx)("label",{children:"Your name"}),Object(O.jsx)("input",{type:"text",placeholder:"Erlich Bachman",value:c,onChange:function(e){return r(e.target.value)}}),Object(O.jsx)("label",{children:"Generated slug"}),Object(O.jsx)("input",{type:"text",value:a,readOnly:!0}),Object(O.jsx)("input",{className:"button-primary",type:"submit",value:"Connect",disabled:a.length<3,onClick:function(n){n.preventDefault(),e.onLogin&&e.onLogin(a)}})]})})})},I=function(e){var n,t=Object(o.useRef)(null),c=function(e){var n=Object(o.useState)(),t=Object(i.a)(n,2),c=t[0],r=t[1],a=Object(o.useState)(),s=Object(i.a)(a,2)[1];return Object(o.useEffect)((function(){var n=new m(e);n.on("update",(function(){return s(b.a.now())})),r(n)}),[e]),c}(e.slug),r=Object(o.useState)(""),a=Object(i.a)(r,2),s=a[0],u=a[1],l=(null!==(n=null===c||void 0===c?void 0:c.chat)&&void 0!==n?n:[]).map((function(e){return"".concat(e.sender,": ").concat(e.content)})).join("\n");return Object(o.useEffect)((function(){return function(){var e;null===(e=t.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[l]),Object(O.jsxs)("div",{children:[Object(O.jsx)("blockquote",{children:Object(O.jsxs)("p",{children:["Welcome ",Object(O.jsx)("strong",{children:e.slug}),"!"]})}),(null===c||void 0===c?void 0:c.loading)||Object(O.jsx)("form",{onSubmit:function(e){e.preventDefault(),null===c||void 0===c||c.sendMessage(s),u("")},children:Object(O.jsxs)("fieldset",{children:[Object(O.jsxs)("pre",{style:{height:300,overflow:"scroll"},children:[l,Object(O.jsx)("div",{ref:t})]}),Object(O.jsx)("input",{type:"text",placeholder:"Your message...",value:s,onChange:function(e){return u(e.target.value)}})]})})]})};var k=function(){var e=Object(o.useState)({type:"login"}),n=Object(i.a)(e,2),t=n[0],c=n[1];return Object(O.jsxs)("div",{className:"container",children:[Object(O.jsx)("h1",{children:"Peer Test"}),Object(O.jsx)("div",{children:"This app is a proof of concept. It demonstrates an UDP based chat. It uses PeerJS."}),"login"===t.type&&Object(O.jsx)(x,{onLogin:function(e){c({type:"chat",slug:e})}}),"chat"===t.type&&Object(O.jsx)(I,{slug:t.slug})]})},w=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,25)).then((function(n){var t=n.getCLS,o=n.getFID,c=n.getFCP,r=n.getLCP,a=n.getTTFB;t(e),o(e),c(e),r(e),a(e)}))};a.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)(k,{})}),document.getElementById("root")),w()}},[[24,1,2]]]);
//# sourceMappingURL=main.e1072cdf.chunk.js.map